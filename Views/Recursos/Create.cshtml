@model StudyHub.Models.Recurso
@{
    ViewData["Title"] = "Agregar Recurso a " + ViewBag.Clase.Titulo;
    var claseId = Model.ClaseId;
}

<div class="container-fluid py-4">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="@Url.Action("Dashboard", "Home")">Dashboard</a></li>
            <li class="breadcrumb-item"><a href="@Url.Action("Index", "Cursos")">Mis Cursos</a></li>
            <li class="breadcrumb-item"><a href="@Url.Action("Details", "Clases", new { id = claseId })">@ViewBag.Clase.Titulo</a></li>
            <li class="breadcrumb-item"><a href="@Url.Action("Index", "Recursos", new { claseId = claseId })">Recursos</a></li>
            <li class="breadcrumb-item active text-muted" aria-current="page">Agregar Recurso</li>
        </ol>
    </nav>

    <div class="row justify-content-center">
        <div class="col-12 col-lg-8">
            <!-- Header -->
            <div class="d-flex align-items-center mb-5">
                <div class="recurso-create-icon bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-3">
                    <i class="bi bi-plus-circle"></i>
                </div>
                <div>
                    <h1 class="h2 mb-1">Agregar Recurso</h1>
                    <p class="text-muted mb-0">
                        <i class="bi bi-journal-text me-1"></i>
                        @ViewBag.Clase.Titulo
                    </p>
                </div>
            </div>

            <!-- Card del Formulario -->
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white border-0 py-3">
                    <h5 class="mb-0">
                        <i class="bi bi-file-earmark-plus text-primary me-2"></i>
                        Nuevo Recurso Educativo
                    </h5>
                </div>
                <div class="card-body p-4">
                    <!-- Alertas de Validación -->
                    <div asp-validation-summary="All" class="alert alert-danger" role="alert">
                        <i class="bi bi-exclamation-triangle-fill me-2"></i>
                        Por favor, corrige los errores en el formulario.
                    </div>

                    <form asp-action="Create" enctype="multipart/form-data" id="recursoForm" class="needs-validation" novalidate>
                        <input type="hidden" asp-for="ClaseId" />
                        
                        <!-- Información de la Clase -->
                        <div class="class-info-card bg-light border-0 rounded p-3 mb-4">
                            <div class="d-flex align-items-center">
                                <i class="bi bi-journal-text text-primary me-2"></i>
                                <div>
                                    <small class="text-muted d-block">Clase</small>
                                    <strong>@ViewBag.Clase.Titulo</strong>
                                </div>
                            </div>
                        </div>

                        <!-- Título del Recurso -->
                        <div class="form-group mb-4">
                            <label asp-for="Titulo" class="form-label fw-semibold">
                                <i class="bi bi-type me-2"></i>Título del Recurso
                            </label>
                            <input asp-for="Titulo" class="form-control" 
                                   placeholder="Ej: Presentación de la Clase, Ejercicios Prácticos, Material de Lectura..."
                                   required />
                            <div class="text-danger small mt-2 d-flex align-items-center">
                                <i class="bi bi-exclamation-circle me-1"></i>
                                <span asp-validation-for="Titulo"></span>
                            </div>
                            <div class="form-text text-muted">
                                <i class="bi bi-info-circle me-1"></i>
                                Elige un título claro y descriptivo para el recurso
                            </div>
                        </div>

                        <!-- Descripción -->
                        <div class="form-group mb-4">
                            <label asp-for="Descripcion" class="form-label fw-semibold">
                                <i class="bi bi-text-paragraph me-2"></i>Descripción
                            </label>
                            <textarea asp-for="Descripcion" class="form-control" rows="4"
                                      placeholder="Describe el contenido, propósito y cómo utilizar este recurso..."
                                      id="descripcionTextarea"></textarea>
                            <div class="text-danger small mt-2 d-flex align-items-center">
                                <i class="bi bi-exclamation-circle me-1"></i>
                                <span asp-validation-for="Descripcion"></span>
                            </div>
                            <div class="form-text text-muted d-flex justify-content-between">
                                <span>
                                    <i class="bi bi-info-circle me-1"></i>
                                    Esta descripción ayudará a los estudiantes a entender el recurso
                                </span>
                                <span class="small">
                                    <span id="descripcionCount">0</span>/500 caracteres
                                </span>
                            </div>
                        </div>

                        <!-- Tipo de Recurso -->
                        <div class="form-group mb-4">
                            <label asp-for="Tipo" class="form-label fw-semibold">
                                <i class="bi bi-folder2-open me-2"></i>Tipo de Recurso
                            </label>
                            <div class="tipo-selector">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="form-check card tipo-option" data-tipo="Archivo">
                                            <div class="card-body text-center p-3">
                                                <input class="form-check-input" type="radio" asp-for="Tipo" value="Archivo" id="tipoArchivo" checked>
                                                <label class="form-check-label" for="tipoArchivo">
                                                    <div class="tipo-icon bg-primary text-white rounded-circle mx-auto mb-2">
                                                        <i class="bi bi-file-earmark-arrow-up"></i>
                                                    </div>
                                                    <h6 class="mb-1">Subir Archivo</h6>
                                                    <small class="text-muted">PDF, Word, PowerPoint, etc.</small>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-check card tipo-option" data-tipo="Enlace">
                                            <div class="card-body text-center p-3">
                                                <input class="form-check-input" type="radio" asp-for="Tipo" value="Enlace" id="tipoEnlace">
                                                <label class="form-check-label" for="tipoEnlace">
                                                    <div class="tipo-icon bg-success text-white rounded-circle mx-auto mb-2">
                                                        <i class="bi bi-link-45deg"></i>
                                                    </div>
                                                    <h6 class="mb-1">Enlace Externo</h6>
                                                    <small class="text-muted">URL, video, sitio web, etc.</small>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="text-danger small mt-2 d-flex align-items-center">
                                <i class="bi bi-exclamation-circle me-1"></i>
                                <span asp-validation-for="Tipo"></span>
                            </div>
                        </div>

                        <!-- Contenido del Recurso (Dinámico) -->
                        <div class="recurso-content-area">
                            <!-- Grupo de Archivo -->
                            <div class="recurso-content-group" id="archivoGroup">
                                <div class="card border-primary bg-primary-light">
                                    <div class="card-body">
                                        <h6 class="card-title text-primary mb-3">
                                            <i class="bi bi-cloud-upload me-2"></i>
                                            Subir Archivo
                                        </h6>
                                        
                                        <div class="file-upload-area">
                                            <div class="file-drop-zone" id="fileDropZone">
                                                <div class="file-drop-content text-center py-5">
                                                    <i class="bi bi-cloud-arrow-up text-primary mb-3" style="font-size: 3rem;"></i>
                                                    <h5 class="text-muted mb-2">Arrastra tu archivo aquí</h5>
                                                    <p class="text-muted small mb-3">o haz clic para seleccionar</p>
                                                    <input type="file" name="archivo" class="form-control d-none" id="fileInput" />
                                                    <button type="button" class="btn btn-outline-primary" id="fileSelectBtn">
                                                        <i class="bi bi-folder2-open me-2"></i>Seleccionar Archivo
                                                    </button>
                                                </div>
                                            </div>
                                            
                                            <div class="file-info mt-3" id="fileInfo" style="display: none;">
                                                <div class="d-flex align-items-center bg-white rounded p-3 border">
                                                    <i class="bi bi-file-earmark-text text-primary me-3" style="font-size: 1.5rem;"></i>
                                                    <div class="flex-grow-1">
                                                        <h6 class="mb-1" id="fileName">Nombre del archivo</h6>
                                                        <small class="text-muted" id="fileSize">Tamaño del archivo</small>
                                                    </div>
                                                    <button type="button" class="btn btn-sm btn-outline-danger" id="fileRemoveBtn">
                                                        <i class="bi bi-x"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="file-requirements mt-3">
                                            <small class="text-muted">
                                                <i class="bi bi-info-circle me-1"></i>
                                                Formatos permitidos: PDF, DOC, DOCX, PPT, PPTX, XLS, XLSX, ZIP, imágenes. Tamaño máximo: 50MB
                                            </small>
                                        </div>
                                        @Html.ValidationMessage("archivo", new { @class = "text-danger small mt-2 d-block" })
                                    </div>
                                </div>
                            </div>

                            <!-- Grupo de Enlace -->
                            <div class="recurso-content-group" id="enlaceGroup" style="display: none;">
                                <div class="card border-success bg-success-light">
                                    <div class="card-body">
                                        <h6 class="card-title text-success mb-3">
                                            <i class="bi bi-link-45deg me-2"></i>
                                            Enlace Externo
                                        </h6>
                                        
                                        <div class="form-group">
                                            <label class="form-label fw-semibold">URL del Recurso</label>
                                            <div class="input-group">
                                                <span class="input-group-text bg-light">
                                                    <i class="bi bi-link"></i>
                                                </span>
                                                <input type="url" name="url" class="form-control" 
                                                       placeholder="https://ejemplo.com/recurso" 
                                                       id="urlInput" />
                                            </div>
                                            <div class="form-text text-muted">
                                                <i class="bi bi-info-circle me-1"></i>
                                                Asegúrate de que el enlace sea accesible para todos los estudiantes
                                            </div>
                                            @Html.ValidationMessage("url", new { @class = "text-danger small mt-2 d-block" })
                                        </div>

                                        <!-- Vista Previa del Enlace (Opcional) -->
                                        <div class="link-preview mt-3" id="linkPreview" style="display: none;">
                                            <h6 class="text-muted mb-2">Vista previa:</h6>
                                            <div class="card bg-light border-0">
                                                <div class="card-body p-3">
                                                    <div class="d-flex align-items-center">
                                                        <i class="bi bi-link-45deg text-success me-3"></i>
                                                        <div class="flex-grow-1">
                                                            <h6 class="mb-1" id="previewTitle">Título del enlace</h6>
                                                            <small class="text-muted" id="previewUrl">URL del enlace</small>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Información Adicional -->
                        <div class="additional-info mt-4">
                            <div class="accordion" id="additionalInfoAccordion">
                                <div class="accordion-item border-0">
                                    <h2 class="accordion-header" id="headingAdditional">
                                        <button class="accordion-button collapsed bg-light" type="button" 
                                                data-bs-toggle="collapse" data-bs-target="#collapseAdditional" 
                                                aria-expanded="false" aria-controls="collapseAdditional">
                                            <i class="bi bi-gear me-2"></i>
                                            Configuración Avanzada (Opcional)
                                        </button>
                                    </h2>
                                    <div id="collapseAdditional" class="accordion-collapse collapse" 
                                         aria-labelledby="headingAdditional" data-bs-parent="#additionalInfoAccordion">
                                        <div class="accordion-body pt-3">
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="form-group mb-3">
                                                        <label class="form-label small fw-semibold">Visibilidad</label>
                                                        <select class="form-select form-select-sm">
                                                            <option value="public" selected>Visible para todos</option>
                                                            <option value="private">Solo para profesores</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="form-group mb-3">
                                                        <label class="form-label small fw-semibold">Fecha de Disponibilidad</label>
                                                        <input type="datetime-local" class="form-control form-control-sm" />
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="notificacionesSwitch">
                                                <label class="form-check-label small" for="notificacionesSwitch">
                                                    Notificar a los estudiantes sobre este recurso
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Acciones -->
                        <div class="d-flex justify-content-between align-items-center mt-4 pt-3 border-top">
                            <a asp-action="Index" asp-route-claseId="@Model.ClaseId" class="btn btn-outline-secondary">
                                <i class="bi bi-arrow-left me-2"></i>Cancelar
                            </a>
                            <div class="btn-group">
                                <button type="button" class="btn btn-outline-warning" id="resetFormBtn">
                                    <i class="bi bi-arrow-clockwise me-2"></i>Limpiar
                                </button>
                                <button type="submit" class="btn btn-primary" id="submitBtn">
                                    <i class="bi bi-check-lg me-2"></i>Crear Recurso
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Información de Ayuda -->
            <div class="card border-0 shadow-sm mt-4">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="text-primary mb-3">
                                <i class="bi bi-lightbulb me-2"></i>
                                Consejos para Recursos
                            </h6>
                            <ul class="small text-muted">
                                <li class="mb-2">Usa nombres descriptivos para facilitar la búsqueda</li>
                                <li class="mb-2">Organiza los recursos por tipo o tema</li>
                                <li class="mb-2">Verifica que los enlaces estén activos</li>
                                <li>Proporciona una descripción clara del contenido</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6 class="text-success mb-3">
                                <i class="bi bi-shield-check me-2"></i>
                                Seguridad y Privacidad
                            </h6>
                            <ul class="small text-muted">
                                <li class="mb-2">Solo sube archivos de fuentes confiables</li>
                                <li class="mb-2">Respeta los derechos de autor</li>
                                <li class="mb-2">Verifica la seguridad de los enlaces externos</li>
                                <li>Mantén actualizados los recursos</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<link rel="stylesheet" href="~/css/views/Recursos.Create.css" asp-append-version="true" />

@section Scripts {
    <script src="~/js/views/Recursos.Create.js" asp-append-version="true"></script>
}
